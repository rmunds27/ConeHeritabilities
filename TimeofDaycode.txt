---
title: "ToD"
output:
  pdf_document: default
  html_document: default
  word_document: default
date: '2022-04-12'
editor_options:
  chunk_output_type: console
---

Loading libraries and data for analysis also adjusting Time to seconds since midnight so time is numeric and not character
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(reshape2)
library(ggplot2)
library(dplyr)
library(lubridate)

ToD<-read.csv("TOD.csv")
summary(ToD)
# Adding a new column to the original and use function to turn H:M:S into seconds since midnight
ToD$seconds <- as.numeric(period_to_seconds(hms(ToD$TOD)))


```

Analysis of time of day effect on the L Ratios

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#glm for L ratois plus an ANOVA
Lratios<-glm(ToD$Lratio~ToD$seconds)
summary(Lratios)
anova(Lratios)
plot(Lratios)
library(reshape2)
library(ggpubr)

#linear regression L ratios
LmLratios<-lm(Lratio~seconds, data=ToD)
summary(LmLratios)
plot(LmLratios)

# include sex and interaction between ToD and Sex
LratiosMF<-glm(ToD$Lratio~ToD$seconds + ToD$Sex + ToD$seconds*ToD$Sex + ToD$Year + ToD$seconds*ToD$Year 
               + ToD$Seconds*ToD$Year*ToD$Sex)
summary(LratiosMF)
anova(LratiosMF)
#When factored, sex seems to wash away the minor affects of time

#Seconds, Sex, and Year
# include sex and interaction between ToD and Sex
LratiosAll<-glm(ToD$Lratio~ToD$seconds + ToD$Sex + ToD$seconds*ToD$Sex + ToD$Year + ToD$seconds*ToD$Year 
               + ToD$seconds*ToD$Year*ToD$Sex)
summary(LratiosAll)

ggplot(ToD, aes(seconds, Lratio))+geom_point()+geom_smooth()
ML<-ggplot(ToD, aes(seconds, Lratio, fill = Sex)) +geom_point() + geom_smooth()+
  labs(y="Ratio of the L to M cones", x="Seconds since midnight")+
   ylim(0.5,2.0)+
  theme_minimal()+
  theme(axis.text.x = element_text(colour = "black", size = 14, face = "bold"),
        axis.text.y = element_text(colour = "black", size = 14),
        axis.title.y = element_text(colour = "black", face = "bold", size = 16),
        axis.title.x = element_text(colour = "black", face = "bold", size = 16))
ML

```

Analysis of time of day effect on S ratio

```{r }

#glm for S ratois plus an ANOVA
Sratios<-glm(ToD$Sratio~ToD$seconds)
summary(Sratios)
anova(Sratios)
plot(Sratios)

#linear regression S ratios
lmSratios<-lm(Sratio~seconds, data=ToD)
summary(lmSratios)
plot(lmSratios)


# include sex and interaction between ToD and Sex
Sratios<-glm(ToD$Sratio~ToD$seconds + ToD$Sex + ToD$seconds*ToD$Sex)
summary(Sratios)
#When factored, sex seems to wash away the minor affects of time

#Seconds, sex, and Year

SratiosAll<-glm(ToD$Sratio~ToD$seconds + ToD$Sex + ToD$seconds*ToD$Sex + ToD$Year + ToD$seconds*ToD$Year 
               + ToD$seconds*ToD$Year*ToD$Sex)
summary(SratiosAll)

Sfig<-ggplot(ToD, aes(seconds, Sratio, fill = Sex)) +geom_point() + geom_smooth()+
  labs(y="Ratio of the S to (L + M) cones", x="Seconds since midnight")+
  ylim(0.05,0.3)+
  theme_minimal()+
  theme(axis.text.x = element_text(colour = "black", size = 14, face = "bold"),
        axis.text.y = element_text(colour = "black", size = 14),
        axis.title.y = element_text(colour = "black", face = "bold", size = 16),
        axis.title.x = element_text(colour = "black", face = "bold", size = 16))
Sfig

#combining ML and S figures into one plot
ggarrange(ML,Sfig,
          labels = c("A. L:M ratio", "B. S:(L+M)ratio"),
          ncol = 2, nrow = 1,
          widths = c(2,2), heights = c(1))


